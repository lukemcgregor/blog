<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  

  <title>Comparing APIs in go, rust, node and dotnet core</title>
  <meta name="description" content="Comparing how a basic API in node, go and dotnet might look, and what the experience and performance is like in each.">
  <meta name="author" content="Luke McGregor">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Comparing APIs in go, rust, node and dotnet core">
  <meta name="twitter:description" content="Comparing how a basic API in node, go and dotnet might look, and what the experience and performance is like in each.">
  
  <meta name="twitter:creator" content="staticv0id">
  
  <meta name="twitter:image" content="/images/favicons/favicon-194x194.png" />

  <meta property="og:type" content="article">
  <meta property="og:title" content="Comparing APIs in go, rust, node and dotnet core">
  <meta property="og:description" content="Comparing how a basic API in node, go and dotnet might look, and what the experience and performance is like in each.">
  <meta property="og:image" content="/images/favicons/favicon-194x194.png" />

  <link rel="apple-touch-icon" sizes="57x57" href="/images/favicons/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/images/favicons/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/images/favicons/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/images/favicons/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/images/favicons/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/images/favicons/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/images/favicons/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/images/favicons/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-194x194.png" sizes="194x194">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/images/favicons/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="/images/favicons/manifest.json">
  <link rel="shortcut icon" href="/images/favicons/favicon.ico">
  <meta name="msapplication-TileColor" content="#ffc40d">
  <meta name="msapplication-TileImage" content="/images/favicons/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <link rel="stylesheet" href="/css/main.css?1521798198461408000">
  <link rel="canonical" href="http://localhost:4000/2017/Comparing_apis_in_go_node_and_dotnet_core/">
  <link rel="alternate" type="application/rss+xml" title="StaticVoid" href="/feed.xml">
</head>


  <body>
    <span class="mobile btn-mobile-menu">
  <i class="icon icon-list btn-mobile-menu__icon"></i>
  <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
</span>

<header class="panel-cover" style="background-image: url(/images/cover.jpg)">
	<div class="panel-main">

		<div class="panel-main__inner panel-inverted">
			<div class="panel-main__content">
				<a href="/" title="link to home of StaticVoid">
					<img src="https://www.gravatar.com/avatar/46e93e55b8f4f652201516c2f7bf3323?s=256" class="user-image" alt="Profile Photo">
					<div class="staticvoid-logo">
						<div class="wrapper">
							<div class="code">static void;</div>
							<div class="comment">// Blog</div>
						</div>
					</div>
				</a>
				<hr class="panel-cover__divider">

				<div class="navigation-wrapper">

					<nav class="cover-navigation cover-navigation--primary">
						<ul class="navigation">
							<li class="navigation__item"><a href="/" title="Archive">Archive</a></li>
						</ul>
					</nav>

					<nav class="cover-navigation navigation--social">
						<ul class="navigation">

							
							<!-- Twitter -->
							<li class="navigation__item">
								<a href="http://twitter.com/staticv0id" title="@staticv0id on Twitter" target="_blank">
									<i class="icon icon-social-twitter"></i>
									<span class="label">Twitter</span>
								</a>
							</li>
							   
							<!-- GitHub -->
							<li class="navigation__item">
								<a href="https://www.github.com/lukemcgregor" title="lukemcgregor on GitHub" target="_blank">
									<i class="icon icon-social-github"></i>
									<span class="label">GitHub</span>
								</a>
							</li>
							 

							<!-- RSS -->
							<li class="navigation__item">
								<a href="/feed.xml" title="Subscribe" target="_blank">
									<i class="icon icon-rss"></i>
									<span class="label">RSS</span>
								</a>
							</li>

						</ul>
					</nav>

				</div>

			</div>

		</div>

		<div class="panel-cover--overlay"></div>
	</div>
</header>


    <div class="content-wrapper">
      <div class="content-wrapper__inner">
        <article class="post-container post-container--single">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="28 Jun 2017" class="post-meta__date date">28 Jun 2017</time>
      
    </div>
    <h1 class="post-title">Comparing APIs in go, rust, node and dotnet core</h1>
  </header>

  <section class="post">
    <p>APIs are an important part of modern web applications. They provide a gateway for communication between a back end server and a frontend application. APIs also provide an integration point for other applications. I come from a dotnet background but I am really interested in seeing how APIs work in other languages, so for fun I wrote basic APIs in dotnet core, go and node.</p>

<p>I built the APIs to cover two different methods</p>

<ul>
  <li>GET <code class="highlighter-rouge">/add/x/to/y</code> which returns a JSON response <code class="highlighter-rouge">{ "sum": &lt;x + y&gt; }</code></li>
  <li>POST <code class="highlighter-rouge">/add</code> which takes a list of numbers in XML <code class="highlighter-rouge">&lt;numbers&gt;&lt;value&gt;x&lt;/value&gt;...&lt;/numbers&gt;</code> and returns <code class="highlighter-rouge">&lt;sum&gt;123&lt;/sum&gt;</code></li>
</ul>

<p>This gives an idea on how serialisation, routing, verbs and body processing work in each language.</p>

<h2 id="dotnet">dotnet</h2>

<p>Dotnet core scaffolds a WebApi for you with the <code class="highlighter-rouge">dotnet new webapi</code> command.</p>

<p><img src="/images/posts/2017/dotnet-core-scaffold.png" alt="Project structure" /></p>

<p>I then deleted some of the un-needed bits from the project like logging and config files. This left me with a total of 85 lines of code across 5 files to implement the basic api. This included many of the scaffolded files like the <code class="highlighter-rouge">.csproj</code> and <code class="highlighter-rouge">Startup.cs</code>.</p>

<h3 id="the-code">The code</h3>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">[XmlRoot(ElementName = "numbers")]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">Numbers</span>
<span class="p">{</span>   
    <span class="p">[</span><span class="nf">XmlElement</span><span class="p">(</span><span class="s">"value"</span><span class="p">)]</span>     
    <span class="k">public</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">Values</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">AddController</span> <span class="p">:</span> <span class="n">Controller</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">HttpGet</span><span class="p">]</span>
    <span class="p">[</span><span class="nf">Route</span><span class="p">(</span><span class="s">"add/{x}/to/{y}"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="n">IActionResult</span> <span class="nf">Get</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">x</span> <span class="p">+</span> <span class="n">y</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="p">[</span><span class="n">HttpPost</span><span class="p">]</span>
    <span class="p">[</span><span class="nf">Route</span><span class="p">(</span><span class="s">"add"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="n">IActionResult</span> <span class="nf">Post</span><span class="p">([</span><span class="n">FromBody</span><span class="p">]</span><span class="n">Numbers</span> <span class="n">numbers</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="k">new</span> <span class="p">{</span> <span class="n">sum</span> <span class="p">=</span> <span class="n">numbers</span><span class="p">.</span><span class="n">Values</span><span class="p">.</span><span class="nf">Sum</span><span class="p">()</span> <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In addition I also needed to add <code class="highlighter-rouge">.AddXmlSerializerFormatters()</code> to the ConfigureServices method in <code class="highlighter-rouge">Startup.cs</code> to enable XML support</p>

<p>I find this code reasonably simple and easy to read. I like that the route information is inline however I dont find the <code class="highlighter-rouge">IActionResult</code> return type particularly intuitive. The Serialisation is automatically handled by content type negotiation</p>

<h2 id="nodejs">nodejs</h2>

<p>For the node example I started with a blank file and looked at a few tutorials to work out what I needed. The node example is a total of <del>42</del> 38 lines (<a href="https://github.com/lukemcgregor/basic-api/pull/1">thanks tcoats</a>) over two files (including the <code class="highlighter-rouge">package.json</code>). I also added content type negotiation to the POST method (<code class="highlighter-rouge">res.format()</code>) for another 6 lines. This is not strictly necessary for the scenario but I thought it might be nice to compare.</p>

<h3 id="the-code-1">The code</h3>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">)()</span>
<span class="kd">var</span> <span class="nx">xml</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'xml'</span><span class="p">)</span>

<span class="kd">var</span> <span class="nx">bodyParser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'body-parser'</span><span class="p">)</span>
<span class="nx">require</span><span class="p">(</span><span class="s1">'body-parser-xml'</span><span class="p">)(</span><span class="nx">bodyParser</span><span class="p">)</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">.</span><span class="nx">xml</span><span class="p">())</span>

<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="s1">'/add/:x/to/:y'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span> <span class="na">sum</span><span class="p">:</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="o">+</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span> <span class="p">})</span>
<span class="p">})</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">'/add'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">sum</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">numbers</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nb">parseInt</span><span class="p">).</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="p">)</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">format</span><span class="p">({</span>
        <span class="na">xml</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">xml</span><span class="p">({</span><span class="na">sum</span><span class="p">:</span><span class="nx">sum</span><span class="p">})),</span>
        <span class="na">json</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span><span class="na">sum</span><span class="p">:</span><span class="nx">sum</span><span class="p">})</span>
    <span class="p">})</span>
<span class="p">})</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">)</span>
</code></pre></div></div>

<p>I really liked the experience of writing an API in node, it was super simple and all of the serialisation was very easy. The thing I disliked the most was having to parse the int values out of strings (in both the XML and the querystring). This was annoying, if anyone knows a way to get typed stuff out on first go that would be really interesting.</p>

<h2 id="go">Go</h2>

<p>I was really excited about doing the Go example as I like quite a lot of the language features. Go came to a total of 48 lines with another 5 if i wanted content type negotiation. I couldnt manage to get the request body to automatically negotiate de-serialisation which was a bit of a shame but I would love to here how to do that if someone knows.</p>

<h3 id="the-code-2">The code</h3>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span><span class="x"> </span><span class="n">main</span><span class="x">

</span><span class="k">import</span><span class="x"> </span><span class="p">(</span><span class="x">
	</span><span class="s">"encoding/xml"</span><span class="x">
	</span><span class="s">"log"</span><span class="x">
	</span><span class="s">"net/http"</span><span class="x">
	</span><span class="s">"strconv"</span><span class="x">

	</span><span class="s">"github.com/jchannon/negotiator"</span><span class="x">
	</span><span class="s">"github.com/julienschmidt/httprouter"</span><span class="x">
</span><span class="p">)</span><span class="x">

</span><span class="k">type</span><span class="x"> </span><span class="n">numbers</span><span class="x"> </span><span class="k">struct</span><span class="x"> </span><span class="p">{</span><span class="x">
	</span><span class="n">Value</span><span class="x"> </span><span class="p">[]</span><span class="kt">int</span><span class="x"> </span><span class="s">`xml:"value"`</span><span class="x">
</span><span class="p">}</span><span class="x">

</span><span class="k">type</span><span class="x"> </span><span class="n">sum</span><span class="x"> </span><span class="k">struct</span><span class="x"> </span><span class="p">{</span><span class="x">
	</span><span class="n">Sum</span><span class="x"> </span><span class="kt">int64</span><span class="x"> </span><span class="s">`xml:",chardata" json:"sum"`</span><span class="x">
</span><span class="p">}</span><span class="x">

</span><span class="k">func</span><span class="x"> </span><span class="n">main</span><span class="p">()</span><span class="x"> </span><span class="p">{</span><span class="x">
	</span><span class="n">router</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">httprouter</span><span class="o">.</span><span class="n">New</span><span class="p">()</span><span class="x">
	</span><span class="n">router</span><span class="o">.</span><span class="n">GET</span><span class="p">(</span><span class="s">"/add/:x/to/:y"</span><span class="p">,</span><span class="x"> </span><span class="k">func</span><span class="p">(</span><span class="n">responseWriter</span><span class="x"> </span><span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span><span class="x"> </span><span class="n">request</span><span class="x"> </span><span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">,</span><span class="x"> </span><span class="n">params</span><span class="x"> </span><span class="n">httprouter</span><span class="o">.</span><span class="n">Params</span><span class="p">)</span><span class="x"> </span><span class="p">{</span><span class="x">
		</span><span class="n">x</span><span class="p">,</span><span class="x"> </span><span class="n">_</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">strconv</span><span class="o">.</span><span class="n">ParseInt</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">ByName</span><span class="p">(</span><span class="s">"x"</span><span class="p">),</span><span class="x"> </span><span class="m">10</span><span class="p">,</span><span class="x"> </span><span class="m">64</span><span class="p">)</span><span class="x">
		</span><span class="n">y</span><span class="p">,</span><span class="x"> </span><span class="n">_</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">strconv</span><span class="o">.</span><span class="n">ParseInt</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">ByName</span><span class="p">(</span><span class="s">"y"</span><span class="p">),</span><span class="x"> </span><span class="m">10</span><span class="p">,</span><span class="x"> </span><span class="m">64</span><span class="p">)</span><span class="x">

		</span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">negotiator</span><span class="o">.</span><span class="n">Negotiate</span><span class="p">(</span><span class="n">responseWriter</span><span class="p">,</span><span class="x"> </span><span class="n">request</span><span class="p">,</span><span class="x"> </span><span class="n">sum</span><span class="p">{</span><span class="n">x</span><span class="x"> </span><span class="o">+</span><span class="x"> </span><span class="n">y</span><span class="p">});</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
			</span><span class="n">http</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="n">responseWriter</span><span class="p">,</span><span class="x"> </span><span class="n">err</span><span class="o">.</span><span class="n">Error</span><span class="p">(),</span><span class="x"> </span><span class="n">http</span><span class="o">.</span><span class="n">StatusInternalServerError</span><span class="p">)</span><span class="x">
		</span><span class="p">}</span><span class="x">
	</span><span class="p">})</span><span class="x">

	</span><span class="n">router</span><span class="o">.</span><span class="n">POST</span><span class="p">(</span><span class="s">"/add"</span><span class="p">,</span><span class="x"> </span><span class="k">func</span><span class="p">(</span><span class="n">responseWriter</span><span class="x"> </span><span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span><span class="x"> </span><span class="n">request</span><span class="x"> </span><span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">,</span><span class="x"> </span><span class="n">params</span><span class="x"> </span><span class="n">httprouter</span><span class="o">.</span><span class="n">Params</span><span class="p">)</span><span class="x"> </span><span class="p">{</span><span class="x">
		</span><span class="n">decoder</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">xml</span><span class="o">.</span><span class="n">NewDecoder</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">Body</span><span class="p">)</span><span class="x">
		</span><span class="k">var</span><span class="x"> </span><span class="n">payload</span><span class="x"> </span><span class="n">numbers</span><span class="x">
		</span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">decoder</span><span class="o">.</span><span class="n">Decode</span><span class="p">(</span><span class="o">&amp;</span><span class="n">payload</span><span class="p">)</span><span class="x">
		</span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
			</span><span class="n">http</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="n">responseWriter</span><span class="p">,</span><span class="x"> </span><span class="n">err</span><span class="o">.</span><span class="n">Error</span><span class="p">(),</span><span class="x"> </span><span class="n">http</span><span class="o">.</span><span class="n">StatusInternalServerError</span><span class="p">)</span><span class="x">
			</span><span class="k">return</span><span class="x">
		</span><span class="p">}</span><span class="x">
		</span><span class="k">defer</span><span class="x"> </span><span class="n">request</span><span class="o">.</span><span class="n">Body</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span><span class="x">
		</span><span class="k">var</span><span class="x"> </span><span class="n">total</span><span class="x"> </span><span class="kt">int64</span><span class="x">

		</span><span class="k">for</span><span class="x"> </span><span class="n">val</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="k">range</span><span class="x"> </span><span class="n">payload</span><span class="o">.</span><span class="n">Value</span><span class="x"> </span><span class="p">{</span><span class="x">
			</span><span class="n">total</span><span class="x"> </span><span class="o">+=</span><span class="x"> </span><span class="kt">int64</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="x">
		</span><span class="p">}</span><span class="x">

		</span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">negotiator</span><span class="o">.</span><span class="n">Negotiate</span><span class="p">(</span><span class="n">responseWriter</span><span class="p">,</span><span class="x"> </span><span class="n">request</span><span class="p">,</span><span class="x"> </span><span class="n">sum</span><span class="p">{</span><span class="n">total</span><span class="p">});</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
			</span><span class="n">http</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="n">responseWriter</span><span class="p">,</span><span class="x"> </span><span class="n">err</span><span class="o">.</span><span class="n">Error</span><span class="p">(),</span><span class="x"> </span><span class="n">http</span><span class="o">.</span><span class="n">StatusInternalServerError</span><span class="p">)</span><span class="x">
		</span><span class="p">}</span><span class="x">
	</span><span class="p">})</span><span class="x">

	</span><span class="n">log</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">ListenAndServe</span><span class="p">(</span><span class="s">":8080"</span><span class="p">,</span><span class="x"> </span><span class="n">router</span><span class="p">))</span><span class="x">
</span><span class="p">}</span><span class="x">

</span></code></pre></div></div>

<p>I was the least happy with how this code turned out. The serialisation stuff was difficult to do, especially in comparison to node. I also find the code to be much less succinct than either of the other languages. I expect this could be alleviated if I knew a few more libraries to help with these things. Its also important to note that this was my very first go program, whereas I have quite a bit of experience with both c# and client-side javascript.</p>

<h2 id="rust-thankskazetsukai">Rust (thanks<a href="https://github.com/lukemcgregor/basic-api/pull/2">@Kazetsukai</a>)</h2>

<p>I know absolutely nothing about rust (before today), so fun times.</p>

<blockquote>
  <p>Rust is a systems programming language that runs blazingly fast, prevents segfaults, and guarantees thread safety.</p>
</blockquote>

<p>The rust example is 42 lines without content type negotiation (including the config files required).</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span><span class="o">!</span><span class="p">[</span><span class="nf">feature</span><span class="p">(</span><span class="n">plugin</span><span class="p">)]</span>
<span class="err">#</span><span class="o">!</span><span class="p">[</span><span class="nf">plugin</span><span class="p">(</span><span class="n">rocket_codegen</span><span class="p">)]</span>

<span class="k">extern</span> <span class="n">crate</span> <span class="n">rocket</span><span class="p">;</span>
<span class="k">extern</span> <span class="n">crate</span> <span class="n">elementtree</span><span class="p">;</span>
<span class="nd">#[macro_use]</span> <span class="k">extern</span> <span class="n">crate</span> <span class="n">rocket_contrib</span><span class="p">;</span>

<span class="k">use</span> <span class="nn">rocket</span><span class="p">::</span><span class="nn">data</span><span class="p">::</span><span class="n">Data</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">rocket_contrib</span><span class="p">::{</span><span class="n">JSON</span><span class="p">,</span> <span class="n">Value</span><span class="p">};</span>
<span class="k">use</span> <span class="nn">elementtree</span><span class="p">::</span><span class="n">Element</span><span class="p">;</span>

<span class="nd">#[get(</span><span class="s">"/add/&lt;x&gt;/to/&lt;y&gt;"</span><span class="nd">)]</span>
<span class="k">fn</span> <span class="nf">add_json</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">i32</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">i32</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">JSON</span><span class="o">&lt;</span><span class="n">Value</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="nf">JSON</span><span class="p">(</span><span class="nd">json!</span><span class="p">({</span> <span class="s">"sum"</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">)</span> <span class="p">}))</span>
<span class="p">}</span>

<span class="nd">#[post(</span><span class="s">"/add"</span><span class="nd">,</span> <span class="nd">data</span> <span class="nd">=</span> <span class="s">"&lt;numbers&gt;"</span><span class="nd">)]</span>
<span class="k">fn</span> <span class="nf">add_xml</span><span class="p">(</span><span class="n">numbers</span><span class="p">:</span> <span class="n">Data</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
	<span class="k">let</span> <span class="n">root</span> <span class="o">=</span> <span class="nn">Element</span><span class="p">::</span><span class="nf">from_reader</span><span class="p">(</span><span class="n">numbers</span><span class="nf">.open</span><span class="p">())</span><span class="nf">.unwrap</span><span class="p">();</span>
	<span class="k">let</span> <span class="n">sum</span> <span class="p">:</span> <span class="nb">i32</span> <span class="o">=</span> <span class="n">root</span><span class="nf">.find_all</span><span class="p">(</span><span class="s">"value"</span><span class="p">)</span><span class="nf">.map</span><span class="p">(|</span><span class="n">e</span><span class="p">|</span> <span class="n">e</span><span class="nf">.text</span><span class="p">()</span><span class="py">.parse</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">i32</span><span class="o">&gt;</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">())</span><span class="nf">.sum</span><span class="p">();</span>

	<span class="k">let</span> <span class="k">mut</span> <span class="n">result</span> <span class="o">=</span> <span class="nn">Element</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="s">"sum"</span><span class="p">);</span>
	<span class="n">result</span><span class="nf">.set_text</span><span class="p">(</span><span class="n">sum</span><span class="nf">.to_string</span><span class="p">());</span>

	<span class="k">return</span> <span class="n">result</span><span class="nf">.to_string</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nn">rocket</span><span class="p">::</span><span class="nf">ignite</span><span class="p">()</span><span class="nf">.mount</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="nd">routes!</span><span class="p">[</span><span class="n">add_json</span><span class="p">,</span> <span class="n">add_xml</span><span class="p">])</span><span class="nf">.launch</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>I find looking a the code the JSON GET example is very elegant and simple, less so the XML POST example. The routing is also super cool, you decorate a function with its route information and then just pass a list of functions to the server. That is super succinct. The performance of the rust service was also amazing being the fastest code example. However the service was not very stable, if I made more concurrent requests than there were cores on the machine the service went into some kind of deadlock, which is pretty poor. Rocket recommends putting the API behind NGINX which would prevent this issue. The tooling support was also much lower than for the other languages. I couldnt get a debugger to work at all, though there are some that are available. This means it wasn’t launchable from VS Code.</p>

<h2 id="performance">Performance</h2>

<p>To get a better idea of the differences between the languages I wrote a load tester which hits each APIs <code class="highlighter-rouge">/add/x/to/y</code> method with a million requests. Just for fun I wrote this in Go which gave me a bit of a chance to play with the concurrency features such as channels.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center"> </th>
      <th style="text-align: center">Median</th>
      <th style="text-align: center">Mean</th>
      <th style="text-align: center">Max</th>
      <th>Total time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center"><strong>go</strong></td>
      <td style="text-align: center">0.21ms</td>
      <td style="text-align: center">0.22ms</td>
      <td style="text-align: center">151.7ms</td>
      <td>28.1s</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>nodejs</strong></td>
      <td style="text-align: center">0.80ms</td>
      <td style="text-align: center">0.97ms</td>
      <td style="text-align: center">34.34ms</td>
      <td>123.3s</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>dotnet</strong></td>
      <td style="text-align: center">0.39ms</td>
      <td style="text-align: center">0.43ms</td>
      <td style="text-align: center">1045.2ms</td>
      <td>54.5s</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>rust</strong></td>
      <td style="text-align: center">0.20ms</td>
      <td style="text-align: center">0.21</td>
      <td style="text-align: center">8.73ms</td>
      <td>27.9s</td>
    </tr>
  </tbody>
</table>

<p>There are a couple of points of interest in this data</p>

<h3 id="nodejs-total-time">nodejs total time</h3>

<p>Node is inherently single threaded, I was hitting the api with concurrent load which is why the total time was so long. I did some research and there are a few ways to get around this, either run a load balancer across multiple instances (which would make sense if this was a docker process) or run a <a href="https://nodejs.org/api/cluster.html">node cluster</a> which is essentially a single machine load balancer across processes.</p>

<blockquote>
  <p>A single instance of Node.js runs in a single thread. To take advantage of multi-core systems the user will sometimes want to launch a cluster of Node.js processes to handle the load.</p>

  <p>The cluster module allows easy creation of child processes that all share server ports.</p>
</blockquote>

<h3 id="dotnet-max-time">dotnet max time</h3>

<p>Dotnet processes perform a process called JIT (Just In Time compilation) which lazy loads code components as they are required, theres a great article about how this works <a href="http://www.telerik.com/blogs/understanding-net-just-in-time-compilation">here</a>. This means that on first request the process is loading modules into memory and performing compilation. This affects the first request on dotnet processes. There are ways of getting around this such as heating the process on deploy or using NGen to produce a native binary that doesn’t require JIT.</p>

<h3 id="conclusions">Conclusions</h3>

<p>I ran this test on both my Windows box (i7) and my macbook (i5) both gave similar proportional results, however the timer resolution for go on windows is very low (0.5ms) which didn’t give as useful figures. As expected Go and rust were the fastest followed by dotnet and nodejs.</p>

  </section>
  <section id="disqus_thread"></section><!-- /#disqus_thread -->
</article>

    <script type="text/javascript">
      var disqus_config = function () {
        this.page.url = 'http://localhost:4000/2017/Comparing_apis_in_go_node_and_dotnet_core/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = '/2017/Comparing_apis_in_go_node_and_dotnet_core'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
      };

      (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = '//staticvoidblog.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
       })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



<script type="application/ld+json">
{ "@context": "http://schema.org",
 "@type": "BlogPosting",
 "headline": "Comparing APIs in go, rust, node and dotnet core",
 "wordcount": "2314",
 "publisher": "StaticVoid",
 "mainEntityOfPage": "http://localhost:4000/2017/Comparing_apis_in_go_node_and_dotnet_core/",
 "publisher": {
   "@type": "Organization",
   "name": "StaticVoid",
  "logo":{
    "@type":"ImageObject",
    "url": "http://localhost:4000/images/favicons/favicon-194x194.png"
  }
 },
 "datePublished": "2017-06-28 00:00:00 +1200",
 "description": "Comparing how a basic API in node, go and dotnet might look, and what the experience and performance is like in each.",
   "author": {
    "@type": "Person",
    "name": "Luke McGregor"
	,"image": "https://www.gravatar.com/avatar/46e93e55b8f4f652201516c2f7bf3323?s=256"
  }
 }
</script>

      </div>

      <footer class="footer">
  <span class="footer__copyright">&copy; 2018 Luke McGregor. All rights reserved.</span>
</footer>

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script type="text/javascript" src="/js/main.js?1521798198461408000"></script>


    </div>
  </body>
</html>