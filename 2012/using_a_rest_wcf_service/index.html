<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  

  <title>Using a REST WCF Service</title>
  <meta name="description" content="WCF WebAPI allows REST support within WCF. This post discusses some of the gotchas of building REST services with WCF and provides a simple tutorial for creating a basic WCF REST service.">
  <meta name="author" content="Luke McGregor">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Using a REST WCF Service">
  <meta name="twitter:description" content="WCF WebAPI allows REST support within WCF. This post discusses some of the gotchas of building REST services with WCF and provides a simple tutorial for creating a basic WCF REST service.">
  
  <meta name="twitter:creator" content="staticv0id">
  
  <meta name="twitter:image" content="/images/favicons/favicon-194x194.png" />

  <meta property="og:type" content="article">
  <meta property="og:title" content="Using a REST WCF Service">
  <meta property="og:description" content="WCF WebAPI allows REST support within WCF. This post discusses some of the gotchas of building REST services with WCF and provides a simple tutorial for creating a basic WCF REST service.">
  <meta property="og:image" content="/images/favicons/favicon-194x194.png" />

  <link rel="apple-touch-icon" sizes="57x57" href="/images/favicons/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/images/favicons/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/images/favicons/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/images/favicons/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/images/favicons/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/images/favicons/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/images/favicons/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/images/favicons/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-194x194.png" sizes="194x194">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/images/favicons/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="/images/favicons/manifest.json">
  <link rel="shortcut icon" href="/images/favicons/favicon.ico">
  <meta name="msapplication-TileColor" content="#ffc40d">
  <meta name="msapplication-TileImage" content="/images/favicons/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <link rel="stylesheet" href="/css/main.css?1529806071253709115">
  <link rel="canonical" href="http://blog.staticvoid.co.nz/2012/using_a_rest_wcf_service/">
  <link rel="alternate" type="application/rss+xml" title="StaticVoid" href="/feed.xml">
</head>


  <body>
    <span class="mobile btn-mobile-menu">
  <i class="icon icon-list btn-mobile-menu__icon"></i>
  <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
</span>

<header class="panel-cover" style="background-image: url(/images/cover.jpg)">
	<div class="panel-main">

		<div class="panel-main__inner panel-inverted">
			<div class="panel-main__content">
				<a href="/" title="link to home of StaticVoid">
					<img src="https://www.gravatar.com/avatar/46e93e55b8f4f652201516c2f7bf3323?s=256" class="user-image" alt="Profile Photo">
					<div class="staticvoid-logo">
						<div class="wrapper">
							<div class="code">static void;</div>
							<div class="comment">// Blog</div>
						</div>
					</div>
				</a>
				<hr class="panel-cover__divider">

				<div class="navigation-wrapper">

					<nav class="cover-navigation cover-navigation--primary">
						<ul class="navigation">							
							<li class="navigation__item"><a href="/" title="Tech">Tech</a></li>
							<li class="navigation__item"><a href="/personal" title="Personal">Personal</a></li>
						</ul>
					</nav>

					<nav class="cover-navigation navigation--social">
						<ul class="navigation">

							
							<!-- Twitter -->
							<li class="navigation__item">
								<a href="http://twitter.com/staticv0id" title="@staticv0id on Twitter" target="_blank">
									<i class="icon icon-social-twitter"></i>
									<span class="label">Twitter</span>
								</a>
							</li>
							   
							<!-- GitHub -->
							<li class="navigation__item">
								<a href="https://www.github.com/lukemcgregor" title="lukemcgregor on GitHub" target="_blank">
									<i class="icon icon-social-github"></i>
									<span class="label">GitHub</span>
								</a>
							</li>
							 

							<!-- RSS -->
							<li class="navigation__item">
								<a href="/feed.xml" title="Subscribe" target="_blank">
									<i class="icon icon-rss"></i>
									<span class="label">RSS</span>
								</a>
							</li>

						</ul>
					</nav>

				</div>

			</div>

		</div>

		<div class="panel-cover--overlay"></div>
	</div>
</header>


    <div class="content-wrapper">
      <div class="content-wrapper__inner">
        <article class="post-container post-container--single">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="15 Feb 2012" class="post-meta__date date">15 Feb 2012</time>
      
    </div>
    <h1 class="post-title">Using a REST WCF Service</h1>
  </header>

  <section class="post">
    <p>I’ve been having a bit of a play with REST and WCF lately, in the past I’ve done this with WebAPI, however given this is still BETA software I wasn’t able to use it in my current project. When I went back to basic WCF with REST I had a few issues creating a working sample, it’s quite fiddly so I thought I would post the example.</p>

<p>The first thing you need is a contract, here’s mine:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">[ServiceContract]</span>
<span class="k">public</span> <span class="k">interface</span> <span class="nc">IHelloService</span>
<span class="p">{</span>
	<span class="p">[</span><span class="n">OperationContract</span><span class="p">]</span>
	<span class="p">[</span><span class="nf">WebInvoke</span><span class="p">(</span><span class="n">UriTemplate</span> <span class="p">=</span> <span class="s">"Hello/{name}"</span><span class="p">,</span> <span class="n">Method</span> <span class="p">=</span> <span class="s">"GET"</span><span class="p">)]</span>
	<span class="kt">string</span> <span class="nf">Hello</span><span class="p">(</span><span class="kt">string</span> <span class="n">name</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>As with all WCF stuff you need your service and operation contracts, in addition for rest you need to use WebInvoke to tell it about the URL and Method you are using, fairly straight forward.</p>

<p>Then a concrete implementation of the contract like this:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="nf">AspNetCompatibilityRequirements</span><span class="p">(</span>
<span class="n">RequirementsMode</span><span class="p">=</span><span class="n">AspNetCompatibilityRequirementsMode</span><span class="p">.</span><span class="n">Required</span><span class="p">)]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">HelloService</span> <span class="p">:</span> <span class="n">IHelloService</span>
<span class="p">{</span>
	<span class="k">public</span> <span class="kt">string</span> <span class="nf">Hello</span><span class="p">(</span><span class="kt">string</span> <span class="n">name</span><span class="p">)</span>
	<span class="p">{</span>
	<span class="k">return</span> <span class="n">String</span><span class="p">.</span><span class="nf">Format</span><span class="p">(</span><span class="s">"Hello {0} how are you?"</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Note the AspNetCompatibilityRequirementsMode header. Unfortunately you seem to
need this in both the Service definition and the web.config, which is a bit
silly IMO.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;system.serviceModel&gt;</span>
	<span class="nt">&lt;serviceHostingEnvironment</span> <span class="na">aspNetCompatibilityEnabled=</span><span class="s">"true"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/system.serviceModel&gt;</span>
</code></pre></div></div>

<p>Then the route binding for the service in your Global.ascx</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">void</span> <span class="nf">RegisterRoutes</span><span class="p">()</span>
<span class="p">{</span>
	<span class="n">RouteTable</span><span class="p">.</span><span class="n">Routes</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">ServiceRoute</span><span class="p">(</span><span class="s">"/hello-service"</span><span class="p">,</span>
		<span class="k">new</span> <span class="nf">WebServiceHostFactory</span><span class="p">(),</span> <span class="k">typeof</span><span class="p">(</span><span class="n">HelloService</span><span class="p">)));</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This looks pretty simple but what’s important is that you use a derivative of WebServiceHostFactory, if you use a derivative of the older ServiceHostFactory, you won’t get a nice error you will just get a <strong>blank page</strong> via the browser.</p>

<p>This is all you really need for the host component of the service</p>

<p>To consume the service you can use the following ChannelFactory style.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="p">(</span><span class="n">ChannelFactory</span><span class="p">&lt;</span><span class="n">IHelloService</span><span class="p">&gt;</span> <span class="n">factory</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ChannelFactory</span><span class="p">&lt;</span><span class="n">IHelloService</span><span class="p">&gt;(</span>
	<span class="k">new</span> <span class="nf">WebHttpBinding</span><span class="p">(),</span> <span class="s">"http://localhost:64373/hello-service"</span><span class="p">))</span>
<span class="p">{</span>
	<span class="n">factory</span><span class="p">.</span><span class="n">Endpoint</span><span class="p">.</span><span class="n">Behaviors</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">WebHttpBehavior</span><span class="p">());</span>

	<span class="kt">var</span> <span class="n">helloService</span> <span class="p">=</span> <span class="n">factory</span><span class="p">.</span><span class="nf">CreateChannel</span><span class="p">();</span>
	<span class="n">helloService</span><span class="p">.</span><span class="nf">Hello</span><span class="p">(</span><span class="s">"Luke"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This is similar to how you would
normally consume a WCF service but with a few important differences</p>

<ul>
  <li>You must use a WebHttpBinding derivative or you will get a SOAP exception similar to the following:</li>
</ul>

<p><em>There was no endpoint listening at
http://localhost:64373/ that could accept the message. This is often caused by
an incorrect address or SOAP action. See InnerException, if present, for more
details.</em></p>

<ul>
  <li>You must add the WebHttpBehavior to the endpoint, I found this quite counter intuitive. If you don’t you will get an error similar to the following:</li>
</ul>

<p><em>Manual addressing is enabled on this factory, so all messages sent must be pre-addressed.</em></p>

<p>Avoiding these gotchas will let you create REST services with WCF</p>

  </section>
  <section id="disqus_thread"></section><!-- /#disqus_thread -->
</article>

    <script type="text/javascript">
      var disqus_config = function () {
        this.page.url = 'http://blog.staticvoid.co.nz/2012/using_a_rest_wcf_service/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = '/2012/using_a_rest_wcf_service'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
      };

      (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = '//staticvoidblog.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
       })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



<script type="application/ld+json">
{ "@context": "http://schema.org",
 "@type": "BlogPosting",
 "headline": "Using a REST WCF Service",
 "wordcount": "569",
 "publisher": "StaticVoid",
 "mainEntityOfPage": "http://blog.staticvoid.co.nz/2012/using_a_rest_wcf_service/",
 "publisher": {
   "@type": "Organization",
   "name": "StaticVoid",
  "logo":{
    "@type":"ImageObject",
    "url": "http://blog.staticvoid.co.nz/images/favicons/favicon-194x194.png"
  }
 },
 "datePublished": "2012-02-15 00:00:00 +0000",
 "description": "WCF WebAPI allows REST support within WCF. This post discusses some of the gotchas of building REST services with WCF and provides a simple tutorial for creating a basic WCF REST service.",
   "author": {
    "@type": "Person",
    "name": "Luke McGregor"
	,"image": "https://www.gravatar.com/avatar/46e93e55b8f4f652201516c2f7bf3323?s=256"
  }
 }
</script>

      </div>

      <footer class="footer">
  <span class="footer__copyright">&copy; 2018 Luke McGregor. All rights reserved.</span>
</footer>

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script type="text/javascript" src="/js/main.js?1529806071253709115"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-28637942-1', 'auto');
  ga('send', 'pageview');
</script>


    </div>
  </body>
</html>